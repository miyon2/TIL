# 1 > 부팅 스크립트와 설정 파일
리눅스 커널을 부팅할 때에는 루트 파일 시스템상의 init(8)을 실행한다. init(8)은 모든 프로세스의 부모 프로세스가 되어 자식 프로세스를 실행하며, 그 자식 프로세스들이 모두 종료되어도 init(8)프로세스만은 시스템 종료시까지 남아있다.

자식 프로세스에는 sshd(8)처럼 데몬으로 상주하는 프로세스 또는 키보드 설정만으로 부팅 시에 한 번 호출되는 것도 있다.

## 1. sysvinit
sysvinit은 대부분의 배포판에서 이용되는 부팅 도구 패키지이다. init은 커널의 하드웨어 초기화 후 커널이 구동하며, `/etc/inittab`을 설정 파일로 읽어들이고 파일에 있는 엔트리ID를 참조해 런레벨을 결정한다.

> **<?> 엔트리ID**
> 엔트리ID는 4문자까지 지정가능한 엔트리 식별 문자이다.


> **<?> 런레벨**
> 런레벨은 시스템의 서비스 실행을 단계별로 구분하여 적용함으로써 관리를 용이하게 하는것이다.
> 런레벨을 생략할 경우 기본 런레벨이 설정된다.
> * 0 - Halt : 시스템 종료
> * 1 - Single user mode : 시스템 복원모드, 관리자 권한 셸을 사용가능하다. 파일시스템 점검에도 사용 가능하다.
> * 2 - Multiuser mode : NFS(Network File System)를 지원하지 않는 다중 사용자 모드이다.
> * 3 - Full muliuser mode : 셸 기반의 인터페이스인 다중 사용자 모드이다. (CLI)
> * 4 - unused : 4번은 사용되지 않지만 정의해서 사용 가능하다.
> * 5 - X11 : 3번모드와 비슷하지만 GUI환경이다.
> * 6 - reboot : 시스템 재부팅

`/etc/inittab`은 파일 전체가 다음과 같은 포맷이 정해져있다.

```
id:runlevel:action:process
```

id에는 엔트리ID가, action은 동작을 정의하며, process는 실행하는 명령어를 지정한다.

## 2. upstart
upstart는 sysvinit을 대체하기 위해 Ubuntu의 프로젝트가 중심이 되어 개발한 패키지이다.

sysvinit은 런레벨 별로 init 스크립트를 나누어 프로세스 구동이나 정지를 관리하지만, upstart는 커널이나 동작 중인 프로세스에서 받는 실행, 중지 이벤트를 통해서 다른 프로세스의 서비스 실행 혹은 중지, 또는 예기지 못한 프로세스의 중지가 발생했을 시 재부팅을 지원하는 등 sysvinit보다는 한층 더 발전된 구동 시스템이다.

upstart는 sysvinit과의 호환성을 위해서 런레벨의 개념은 그대로 사용하는 대신 **event**와 **job**개념을 바탕으로 동작한다.

구동시 `.conf`확장자 파일을 job으로 사용가능하며, sysvinit에서 쓰는 설정 파일도 사용할 수 있다.

#### job의 기술 방법
job파일은 `/etc/init/`아래에 `job이름.conf`로 생성한다. 또한 각 job파일 내에서 지정하는 각 항목은 **스탠자**라고 명명하며 각 job파일은 job의 실행 및 중지를 담당한다.

* start on / stop on : 이벤트를 받는 스탠자
* emit : 이벤트를 주는 스탠자

스탠자에는 크게 두가지 유형이 있다. **task**는 짧은 프로세스로, 처리가 종료되면 job도 종료된다. **service**는 apache와 같은 데몬 job으로서, task가 명시적으로 쓰여 있지 않은 경우에는 service로 분류된다.

또한 job파일은 bash 베이스의 스크립트도 처리 가능하며 쓰이는 스탠자는 다음과 같다.

| 명령어 | 기능 |
|:--------:|:--------:|
| pre-start | 프로세스 실행 전에 처리 |
| post-start | 프로세스 실행 후에 처리 |
| pre-stop | 프로세스 종료 전에 처리 |
| post-stop | 프로세스 종료 후에 처리 |

스크립트는 `pre-start script`부터 `end script`를 감싼 부분이다.

이외에도 자주 쓰이는 스탠자는 다음과 같다.

| 명령어 | 기능 |
|:--------:|:--------:|
| env | 환경 변수를 정의 |
| exec | job으로 실행하려는 프로세스의 파일을 지정, 실해 |
| respawn | exec로 실행한 프로세스가 종료된 경우 재시작 |
| umask | 프로세스의 umask를 지정 |
| kill timeout | 지정한 시간이 경과한 후 프로세스에 SIGTERM, SIGKILL을 보냄 |
| expect | 데몬으로서 동작시키는 방법을 지정해 PID를 upstart에 통보<br>fork는 1번 fork, daemon은 2번 fork |
| normal exit | job 종료 조건이 되는 프로세스로부터의 반환 값을 정의 |
| console | 출력할 곳을 지정 |

#### initctl 사용
upstart는 job관리에 initctl(8)을 사용한다.
주요 기능은 다음 표와 같다.

| 커맨드 | 기능 |
|:--------:|:--------:|
| start | 뒤에 job 이름을 지정해 프로세스를 시작<br>job 이름 뒤에 '변수=값'으로 환경변수 지정 가능 |
| stop | 뒤에 job 이름을 지정해 프로세스를 종료<br>'변수=값'을 뒤에 지정하면 환경변수 지정 가능 |
| restart | job을 stop하고 start함 |
| reload | job 프로세스에 SIGHUP을 보낸다 |
| status | 프로세스 상태 표시 |
| list | job 리스트 표시 |
| emit | 이벤트명을 지정하여 해당 이벤트를 발생시킴 |
| reload-configuration | init(8)의 설정파일을 다시 읽어들임<br>갱신되면 자동으로 다시 읽어들이도록 설정되어있음 |
| log-priority | job의 우선도를 지정 |
| show-config | job 파일의 일부 내용을 표시 |
| check-config | job 파일 리스트에서 실행할 수 없거나 중지할 수 없는 job파일을 확인 |
